# LangGraph + Supabase 集成测试计划

## 1. 测试概述

### 1.1 测试目标

确保 LangGraph AI 工作流生成功能与 Supabase 后端服务的集成稳定性、数据一致性和安全性。

### 1.2 测试范围

- LangGraph 状态图执行流程
- Supabase API 接口交互
- 身份验证和权限控制
- 数据读写操作
- 实时同步功能

## 2. 测试环境配置

### 2.1 环境要求

- Node.js >= 20.11.1
- Playwright >= 1.57.0
- Supabase 测试项目
- Ollama 本地服务（用于 AI 生成）

### 2.2 测试数据准备

- 测试用户账户
- 示例工作流数据
- 模拟用户输入和预期输出

## 3. 测试用例设计

### 3.1 Supabase API 交互测试

#### TC-SUP-001: 客户端初始化

- **测试步骤**:
  1. 调用 SupabaseClient.initialize()
  2. 验证客户端状态
- **预期结果**: 客户端成功初始化，initialized = true
- **优先级**: P0

#### TC-SUP-002: 工作流 CRUD 操作

- **测试步骤**:
  1. 创建工作流
  2. 查询工作流
  3. 更新工作流
  4. 删除工作流
- **预期结果**: 所有操作成功，数据一致
- **优先级**: P0

#### TC-SUP-003: 批量操作

- **测试步骤**:
  1. 批量插入工作流
  2. 批量查询工作流
- **预期结果**: 批量操作正确执行
- **优先级**: P1

### 3.2 身份验证测试

#### TC-AUTH-001: 用户注册

- **测试步骤**:
  1. 调用 signUp() 注册新用户
  2. 验证用户创建
- **预期结果**: 用户成功创建，返回用户信息
- **优先级**: P0

#### TC-AUTH-002: 用户登录

- **测试步骤**:
  1. 调用 signInWithPassword()
  2. 获取会话信息
- **预期结果**: 登录成功，会话有效
- **优先级**: P0

#### TC-AUTH-003: 会话管理

- **测试步骤**:
  1. 获取会话
  2. 刷新会话
  3. 登出
- **预期结果**: 会话操作正常
- **优先级**: P1

### 3.3 LangGraph 执行测试

#### TC-LANG-001: 完整流程执行

- **测试步骤**:
  1. 输入用户请求
  2. 执行 LangGraph.run()
  3. 验证生成的 JSON
- **预期结果**: 生成有效的工作流 JSON
- **优先级**: P0

#### TC-LANG-002: 错误处理和重试

- **测试步骤**:
  1. 提供无效输入
  2. 验证重试机制
- **预期结果**: 错误被捕获，重试正常工作
- **优先级**: P1

#### TC-LANG-003: 节点状态传递

- **测试步骤**:
  1. 执行图执行
  2. 检查状态传递
- **预期结果**: 状态正确传递到下一节点
- **优先级**: P1

### 3.4 数据一致性测试

#### TC-DATA-001: 本地与远程同步

- **测试步骤**:
  1. 创建本地工作流
  2. 同步到 Supabase
  3. 验证数据一致性
- **预期结果**: 本地和远程数据一致
- **优先级**: P0

#### TC-DATA-002: 并发操作

- **测试步骤**:
  1. 并发创建工作流
  2. 检查数据完整性
- **预期结果**: 无数据冲突
- **优先级**: P1

### 3.5 权限控制测试

#### TC-PERM-001: 所有权验证

- **测试步骤**:
  1. 用户 A 创建工作流
  2. 用户 B 尝试访问
- **预期结果**: 用户 B 无法访问用户 A 的工作流
- **优先级**: P0

#### TC-PERM-002: 共享权限

- **测试步骤**:
  1. 分享工作流给用户 B
  2. 验证用户 B 的访问权限
- **预期结果**: 共享权限正确生效
- **优先级**: P1

## 4. 自动化测试实现

### 4.1 测试框架

- Playwright（端到端测试）
- Jest（单元测试）

### 4.2 测试配置

- 测试环境变量
- Supabase 测试项目配置
- 报告生成配置

## 5. 验收标准

### 5.1 功能要求

- 所有 P0 测试用例通过率 100%
- 所有 P1 测试用例通过率 >= 95%

### 5.2 性能要求

- API 响应时间 < 3s
- 页面加载时间 < 5s

### 5.3 可靠性要求

- 错误处理覆盖所有异常情况
- 无数据丢失或损坏
