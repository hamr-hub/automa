<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ollama é›†æˆç«¯åˆ°ç«¯æµ‹è¯•</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          'Helvetica Neue', Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 900px;
        width: 100%;
        padding: 40px;
      }

      h1 {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 10px;
        color: #1a202c;
      }

      .subtitle {
        color: #718096;
        margin-bottom: 30px;
        font-size: 16px;
      }

      .test-controls {
        display: flex;
        gap: 12px;
        margin-bottom: 30px;
      }

      button {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .btn-primary {
        background: #4299e1;
        color: white;
      }

      .btn-primary:hover {
        background: #3182ce;
      }

      .btn-secondary {
        background: #edf2f7;
        color: #2d3748;
      }

      .btn-secondary:hover {
        background: #e2e8f0;
      }

      .summary {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
        margin-bottom: 30px;
      }

      .summary-card {
        background: #f7fafc;
        padding: 20px;
        border-radius: 12px;
        border-left: 4px solid;
      }

      .summary-card.total {
        border-color: #667eea;
      }

      .summary-card.passed {
        border-color: #48bb78;
      }

      .summary-card.failed {
        border-color: #f56565;
      }

      .summary-value {
        font-size: 36px;
        font-weight: 700;
        margin-bottom: 4px;
      }

      .summary-label {
        color: #718096;
        font-size: 14px;
      }

      .test-results {
        background: #f7fafc;
        border-radius: 12px;
        padding: 20px;
        max-height: 500px;
        overflow-y: auto;
      }

      .test-item {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        padding: 16px;
        background: white;
        border-radius: 8px;
        margin-bottom: 12px;
        border-left: 4px solid #cbd5e0;
      }

      .test-item.passed {
        border-left-color: #48bb78;
      }

      .test-item.failed {
        border-left-color: #f56565;
      }

      .test-icon {
        font-size: 24px;
        flex-shrink: 0;
      }

      .test-content {
        flex: 1;
      }

      .test-name {
        font-weight: 600;
        margin-bottom: 4px;
        color: #2d3748;
      }

      .test-error {
        color: #e53e3e;
        font-size: 14px;
        margin-top: 8px;
        padding: 8px 12px;
        background: #fff5f5;
        border-radius: 6px;
      }

      .loading {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid #cbd5e0;
        border-top-color: #4299e1;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #a0aec0;
      }

      .empty-state svg {
        width: 80px;
        height: 80px;
        margin-bottom: 16px;
        opacity: 0.3;
      }

      pre {
        background: #2d3748;
        color: #e2e8f0;
        padding: 16px;
        border-radius: 8px;
        overflow-x: auto;
        font-size: 13px;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ§ª Ollama é›†æˆç«¯åˆ°ç«¯æµ‹è¯•</h1>
      <p class="subtitle">éªŒè¯æ‰€æœ‰ Ollama è°ƒç”¨ç»Ÿä¸€é€šè¿‡ LangGraphService</p>

      <div class="test-controls">
        <button id="runTests" class="btn-primary">
          <span>â–¶ï¸</span>
          <span>è¿è¡Œæµ‹è¯•</span>
        </button>
        <button id="clearResults" class="btn-secondary">
          <span>ğŸ—‘ï¸</span>
          <span>æ¸…é™¤ç»“æœ</span>
        </button>
      </div>

      <div class="summary" id="summary" style="display: none">
        <div class="summary-card total">
          <div class="summary-value" id="totalTests">0</div>
          <div class="summary-label">æ€»æµ‹è¯•æ•°</div>
        </div>
        <div class="summary-card passed">
          <div class="summary-value" id="passedTests">0</div>
          <div class="summary-label">é€šè¿‡</div>
        </div>
        <div class="summary-card failed">
          <div class="summary-value" id="failedTests">0</div>
          <div class="summary-label">å¤±è´¥</div>
        </div>
      </div>

      <div class="test-results" id="testResults">
        <div class="empty-state">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M9 11l3 3L22 4"></path>
            <path
              d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"
            ></path>
          </svg>
          <p>ç‚¹å‡»"è¿è¡Œæµ‹è¯•"å¼€å§‹æµ‹è¯•</p>
        </div>
      </div>

      <pre id="consoleOutput" style="display: none"></pre>
    </div>

    <script type="module">
      import runE2ETests from './e2e-ollama-integration.js';

      const runTestsBtn = document.getElementById('runTests');
      const clearResultsBtn = document.getElementById('clearResults');
      const summaryDiv = document.getElementById('summary');
      const resultsDiv = document.getElementById('testResults');
      const consoleOutput = document.getElementById('consoleOutput');

      let logs = [];

      // æ‹¦æˆª console.log
      const originalLog = console.log;
      const originalError = console.error;

      console.log = (...args) => {
        originalLog(...args);
        logs.push(args.join(' '));
      };

      console.error = (...args) => {
        originalError(...args);
        logs.push('ERROR: ' + args.join(' '));
      };

      runTestsBtn.addEventListener('click', async () => {
        runTestsBtn.disabled = true;
        runTestsBtn.innerHTML =
          '<span class="loading"></span><span>æµ‹è¯•ä¸­...</span>';

        logs = [];
        resultsDiv.innerHTML = '';
        summaryDiv.style.display = 'none';
        consoleOutput.style.display = 'none';

        try {
          const results = await runE2ETests();

          // æ˜¾ç¤ºæ€»ç»“
          summaryDiv.style.display = 'grid';
          document.getElementById('totalTests').textContent = results.total;
          document.getElementById('passedTests').textContent = results.passed;
          document.getElementById('failedTests').textContent = results.failed;

          // æ˜¾ç¤ºæµ‹è¯•é¡¹
          resultsDiv.innerHTML = results.tests
            .map(
              (test) => `
          <div class="test-item ${test.passed ? 'passed' : 'failed'}">
            <div class="test-icon">${test.passed ? 'âœ…' : 'âŒ'}</div>
            <div class="test-content">
              <div class="test-name">${test.name}</div>
              ${test.error ? `<div class="test-error">${test.error}</div>` : ''}
            </div>
          </div>
        `
            )
            .join('');

          // æ˜¾ç¤ºæ§åˆ¶å°æ—¥å¿—
          consoleOutput.textContent = logs.join('\n');
          consoleOutput.style.display = 'block';
        } catch (error) {
          resultsDiv.innerHTML = `
          <div class="test-item failed">
            <div class="test-icon">âŒ</div>
            <div class="test-content">
              <div class="test-name">æµ‹è¯•æ‰§è¡Œå¤±è´¥</div>
              <div class="test-error">${error.message}</div>
            </div>
          </div>
        `;
        } finally {
          runTestsBtn.disabled = false;
          runTestsBtn.innerHTML = '<span>â–¶ï¸</span><span>è¿è¡Œæµ‹è¯•</span>';
        }
      });

      clearResultsBtn.addEventListener('click', () => {
        resultsDiv.innerHTML = `
        <div class="empty-state">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 11l3 3L22 4"></path>
            <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path>
          </svg>
          <p>ç‚¹å‡»"è¿è¡Œæµ‹è¯•"å¼€å§‹æµ‹è¯•</p>
        </div>
      `;
        summaryDiv.style.display = 'none';
        consoleOutput.style.display = 'none';
        logs = [];
      });
    </script>
  </body>
</html>
