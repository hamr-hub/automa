# Implement AI Page Parsing and Workflow Generation

I will implement the ability for the Automa AI Agent to parse the content of an active browser tab, understand its structure (lists, pagination), and automatically generate a robust scraping workflow.

## 1. Create DOM Simplification Utility
Create `src/utils/domSimplifier.js` to extract a token-efficient representation of the page structure for the LLM.
- **Function**: `getSimplifiedDOM()`
- **Features**:
    - Identify key containers, lists, and interactive elements.
    - Extract simplified hierarchy (tag, class, id, text snippet).
    - Limit depth and size to fit in context window.

## 2. Update AI Workflow Generator UI
Modify `src/newtab/pages/AIWorkflowGenerator.vue` to allow selecting a target tab for analysis.
- **Add Tab Selector**: A dropdown to list current open tabs (excluding Automa tabs).
- **Add "Analyze" Button**: Triggers the DOM extraction on the selected tab.
- **State Management**: Store the extracted `pageContext` in the component state.

## 3. Update AI Prompts
Modify `src/services/ai/prompts/workflow-generation.js` to utilize the page context.
- **System Prompt**: Add instructions on how to interpret the `pageContext`.
- **Workflow Patterns**:
    - **Pagination**: Explicitly instruct the AI to use a `PAGINATION` (While Loop) block wrapping the content, AND include a `CLICK` step for the "Next" button at the end of the loop body.
    - **Lists**: Instruct to use `LOOP_ELEMENTS` for detected repeated structures (products, articles).

## 4. Verify and Refine Workflow Generator
Ensure `src/services/ai/WorkflowGenerator.js` correctly handles the complex nested structures generated by the AI.
- **Validation**: Verify `loopStack` logic handles `PAGINATION` -> `LOOP_ELEMENTS` -> `EXTRACT` -> `LOOP_END` -> `CLICK` -> `LOOP_END` correctly.
- **Mapping**: Ensure `PAGINATION` maps to `while-loop` with the correct "Element Exists" condition.

## 5. Execution Flow
1. User opens "AI Workflow Generator".
2. User selects "Target Tab" (e.g., "Amazon Search Results").
3. User enters prompt: "Scrape all products".
4. System extracts DOM from target tab.
5. System sends Prompt + DOM to LLM.
6. LLM generates JSON steps with precise selectors and logic.
7. System renders the workflow.
